syntax = "proto3";

package bible.v1;

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";
import "protoc-gen-openapiv2/options/annotations.proto";

// Ref:
// https://grpc-ecosystem.github.io/grpc-gateway/docs/development/grpc-gateway_v2_migration_guide/
option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_swagger) = {
  info: {
    version: "1.0.0"
    title: "Bible Version server API"
    description: "Bible Version server API"
    contact: {
      name: "DuckyMomo20012"
      url: "https://github.com/DuckyMomo20012"
    }
  }
  // NOTE: This is default mount point in internal/common/server/gateway.go
  base_path: "/api"

  security_definitions: {
    security: {
      key: "bearer"
      value: {
        type: TYPE_API_KEY
        in: IN_HEADER
        name: "Authorization"
        description: "Authentication token, prefixed by Bearer: Bearer <token>"
      }
    }
  }
  security: {
    security_requirement: {key: "bearer"}
  }
};

// Version service definition
service VersionService {
  // Retrieve all versions
  rpc GetAllVersion(GetAllVersionRequest) returns (GetAllVersionResponse) {
    option (google.api.http) = {get: "/v1/version"};
  }
  // Retrieve one version by unique constraint
  rpc GetOneVersion(GetOneVersionRequest) returns (GetOneVersionResponse) {
    option (google.api.http) = {get: "/v1/version/{version_code}"};
  }
}

message Version {
  // Version ID
  string id = 1;
  // Version code
  string code = 2;
  // Version name
  string name = 3;
  // Version language
  string language = 4;
  // Version source
  string source = 5;
  // Version format type
  string format_type = 6;
  // Version source URL
  string source_url = 7;
  // Version has old testament
  bool has_old_testament = 8;
  // Version has new testament
  bool has_new_testament = 9;
  // Version has apocrypha
  bool has_apocrypha = 10;
  // Version creation time
  // Stored in UTC and follows RFC 3339 format
  google.protobuf.Timestamp created_at = 11;
  // Version last update time
  // Stored in UTC and follows RFC 3339 format
  google.protobuf.Timestamp updated_at = 12;
}

message GetAllVersionRequest {
  // Language filter (optional - indexed in Prisma)
  optional string language = 1;
  // Source filter (optional - indexed in Prisma)
  optional string source = 2;
  // Format type filter (optional - indexed in Prisma)
  optional string format_type = 3;
}

message GetAllVersionResponse {
  // Version list
  repeated Version versions = 1;
}

message GetOneVersionRequest {
  // Version code (required - part of unique constraint)
  string version_code = 1;
  // Language code (required - part of unique constraint)
  string language = 2;
  // Source (required - part of unique constraint)
  string source = 3;
  // Format type (required - part of unique constraint)
  string format_type = 4;
}

message GetOneVersionResponse {
  // Version object
  Version version = 1;
}
